# TSN V2 Environment Configuration
# Copy to .env and customize

# ============================================================================
# ENVIRONMENT
# ============================================================================
TSN_ENVIRONMENT=development  # development, staging, production
TSN_DEBUG=false

# ============================================================================
# DATABASE (MySQL/MariaDB)
# ============================================================================
TSN_DB_ENGINE=mysql
TSN_DB_HOST=51.81.202.9
TSN_DB_PORT=3306
TSN_DB_NAME=repeater
TSN_DB_USER=server
TSN_DB_PASSWORD=wowhead1
TSN_DB_DRIVER=  # optional override e.g. asyncmy
TSN_DB_POOL_SIZE=20
TSN_DB_MAX_OVERFLOW=10
TSN_DB_POOL_TIMEOUT=30

# ============================================================================
# NODE CONFIGURATION (Repeater Site)
# ============================================================================
TSN_NODE_ID=node-1
TSN_NODE_AUDIO_INCOMING_DIR=/path/to/incoming
TSN_NODE_AUDIO_ARCHIVE_DIR=/path/to/archive

# SFTP Transfer
TSN_NODE_SFTP_HOST=server.example.com
TSN_NODE_SFTP_PORT=22
TSN_NODE_SFTP_USERNAME=tsn_upload
TSN_NODE_SFTP_KEY_PATH=/home/user/.ssh/id_rsa
TSN_NODE_SFTP_PASSWORD=  # Optional if using key
TSN_NODE_SFTP_REMOTE_DIR=/incoming

# Watcher Settings
TSN_NODE_WATCH_INTERVAL_SEC=1.0
TSN_NODE_MIN_FILE_AGE_SEC=2.0
TSN_NODE_MIN_FILE_SIZE=1000

# ============================================================================
# TRANSCRIPTION (Whisper)
# ============================================================================
TSN_WHISPER_BACKEND=faster-whisper  # faster-whisper, whisper.cpp, openai
TSN_WHISPER_MODEL=medium.en
TSN_WHISPER_DEVICE=cuda  # cuda, cpu, auto
TSN_WHISPER_COMPUTE_TYPE=float16  # float16, int8, int8_float16
TSN_WHISPER_LANGUAGE=en

TSN_WHISPER_BEAM_SIZE=5
TSN_WHISPER_VAD_FILTER=true
TSN_WHISPER_TEMPERATURE=0.0

TSN_WHISPER_MAX_CONCURRENT=4
TSN_WHISPER_TIMEOUT_SEC=300

# ============================================================================
# vLLM (AI Analysis)
# ============================================================================
TSN_VLLM_BASE_URL=http://192.168.0.104:8001/v1
TSN_VLLM_MODEL=Qwen/Qwen2.5-7B-Instruct-GPTQ-Int4
TSN_VLLM_API_KEY=sk-no-auth-needed-for-local

TSN_VLLM_TIMEOUT_SEC=120
TSN_VLLM_MAX_RETRIES=4
TSN_VLLM_MAX_CONCURRENT=10

# OpenAI Fallback (optional)
TSN_VLLM_FALLBACK_ENABLED=false
TSN_VLLM_OPENAI_API_KEY=sk-your-openai-key-here
TSN_VLLM_OPENAI_MODEL=gpt-4o-mini

# ============================================================================
# QRZ API (Callsign Validation)
# ============================================================================
TSN_QRZ_ENABLED=false
TSN_QRZ_USERNAME=your_qrz_username
TSN_QRZ_PASSWORD=your_qrz_password
TSN_QRZ_CACHE_TTL_SEC=86400

# ============================================================================
# PROCESSING
# ============================================================================
TSN_PROC_MAX_RETRIES=3
TSN_PROC_RETRY_BACKOFF_BASE=2.0
TSN_PROC_RETRY_MAX_WAIT_SEC=300

TSN_PROC_BATCH_SIZE=100
TSN_PROC_QUEUE_POLL_INTERVAL_SEC=1.0

# Stage Timeouts
TSN_PROC_INGESTION_TIMEOUT_SEC=60
TSN_PROC_TRANSCRIPTION_TIMEOUT_SEC=300
TSN_PROC_EXTRACTION_TIMEOUT_SEC=60
TSN_PROC_ANALYSIS_TIMEOUT_SEC=180

# ============================================================================
# ANALYSIS (vLLM)
# ============================================================================
TSN_ANALYSIS_GPU_WATCH_ENABLED=true
TSN_ANALYSIS_GPU_LOW_UTILIZATION_PCT=35.0
TSN_ANALYSIS_GPU_CHECK_INTERVAL_SEC=15
TSN_ANALYSIS_GPU_OVERDRIVE_BUDGET=31500
TSN_ANALYSIS_OVERDRIVE_WINDOW_HOURS=168
TSN_ANALYSIS_OVERDRIVE_BATCH_SIZE=6
TSN_ANALYSIS_OVERDRIVE_COOLDOWN_HOURS=12
TSN_ANALYSIS_PROFILE_REFRESH_HOURS=12
TSN_ANALYSIS_PROFILE_CONTEXT_HOURS=240
TSN_ANALYSIS_PROFILE_BATCH_SIZE=3
TSN_ANALYSIS_PROFILE_MIN_SEEN_COUNT=5
TSN_ANALYSIS_TRANSCRIPT_SMOOTHING_ENABLED=true
TSN_ANALYSIS_TRANSCRIPT_SMOOTHING_BATCH_SIZE=4
TSN_ANALYSIS_FAILED_ANALYSIS_RESCUE_MINUTES=10
TSN_ANALYSIS_FAILED_ANALYSIS_RESCUE_BATCH=25
TSN_ANALYSIS_FAILED_ANALYSIS_RETRY_LIMIT=20
TSN_ANALYSIS_GPU_SATURATION_THRESHOLD_PCT=95.0
TSN_ANALYSIS_PURGE_NET_HISTORY_ON_BOOT=false

# ============================================================================
# LOGGING
# ============================================================================
TSN_LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
TSN_LOG_FORMAT=json  # json, console
TSN_LOG_OUTPUT=stdout  # stdout, file
TSN_LOG_FILE_PATH=/var/log/tsn/app.log
TSN_LOG_ROTATE_MB=100

# ============================================================================
# METRICS (Prometheus)
# ============================================================================
TSN_METRICS_ENABLED=true
TSN_METRICS_PORT=9090
TSN_METRICS_PATH=/metrics

# ============================================================================
# WEB PORTAL
# ============================================================================
TSN_WEB_SESSION_SECRET=change-me
TSN_WEB_BRAND_NAME=KK7NQN
TSN_WEB_SUPPORT_EMAIL=radio@example.com
TSN_WEB_ALLOW_REGISTRATION=true
TSN_WEB_PUBLIC_DASHBOARD=true
TSN_WEB_VLLM_API_KEY=
TSN_WEB_OPENAI_API_KEY=
# Host port exposed by the docker-compose tsn_web service
TSN_WEB_PORT=8081
